@using SchedulerPlatform.UI.Models

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.AccountBalance" Class="mr-2" />
            Account Details
        </MudText>
    </TitleContent>
    <DialogContent>
        @if (Account != null)
        {
            <MudGrid>
                <MudItem xs="12">
                    <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Account Information</strong></MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">VM Account ID</MudText>
                    <MudText Typo="Typo.body1">@Account.VMAccountId</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Account Number</MudText>
                    <MudText Typo="Typo.body1">@Account.VMAccountNumber</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Interface Account ID</MudText>
                    <MudText Typo="Typo.body1">@(Account.InterfaceAccountId ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Credential ID</MudText>
                    <MudText Typo="Typo.body1">@Account.CredentialId</MudText>
                </MudItem>

                <MudItem xs="12">
                    <MudDivider Class="my-2" />
                    <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Client & Vendor</strong></MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Client</MudText>
                    <MudText Typo="Typo.body1">@(Account.ClientName ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Vendor Code</MudText>
                    <MudText Typo="Typo.body1">@(Account.VendorCode ?? "N/A")</MudText>
                </MudItem>

                <MudItem xs="12">
                    <MudDivider Class="my-2" />
                    <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Billing Pattern</strong></MudText>
                </MudItem>
                <MudItem xs="4">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Period Type</MudText>
                    <MudText Typo="Typo.body1">@(Account.PeriodType ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="4">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Period Days</MudText>
                    <MudText Typo="Typo.body1">@(Account.PeriodDays?.ToString() ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="4">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Median Days</MudText>
                    <MudText Typo="Typo.body1">@(Account.MedianDays?.ToString("F1") ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Invoice Count</MudText>
                    <MudText Typo="Typo.body1">@(Account.InvoiceCount?.ToString() ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Last Invoice Date</MudText>
                    <MudText Typo="Typo.body1">@(Account.LastInvoiceDateTime?.ToString("MM/dd/yyyy") ?? "N/A")</MudText>
                </MudItem>

                <MudItem xs="12">
                    <MudDivider Class="my-2" />
                    <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Schedule Information</strong></MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Next Run Date</MudText>
                    <MudText Typo="Typo.body1">@(Account.NextRunDateTime?.ToString("MM/dd/yyyy") ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Days Until Next Run</MudText>
                    <MudText Typo="Typo.body1">@(Account.DaysUntilNextRun?.ToString() ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Next Range Start</MudText>
                    <MudText Typo="Typo.body1">@(Account.NextRangeStartDateTime?.ToString("MM/dd/yyyy") ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Next Range End</MudText>
                    <MudText Typo="Typo.body1">@(Account.NextRangeEndDateTime?.ToString("MM/dd/yyyy") ?? "N/A")</MudText>
                </MudItem>

                <MudItem xs="12">
                    <MudDivider Class="my-2" />
                    <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Status</strong></MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Next Run Status</MudText>
                    @if (!string.IsNullOrEmpty(Account.NextRunStatus))
                    {
                        <MudChip T="string" Size="Size.Small" Color="@GetNextRunStatusColor(Account.NextRunStatus)">
                            @Account.NextRunStatus
                        </MudChip>
                    }
                    else
                    {
                        <MudText Typo="Typo.body1">N/A</MudText>
                    }
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Historical Billing Status</MudText>
                    @if (!string.IsNullOrEmpty(Account.HistoricalBillingStatus))
                    {
                        <MudChip T="string" Size="Size.Small" Color="@GetHistoricalStatusColor(Account.HistoricalBillingStatus)">
                            @Account.HistoricalBillingStatus
                        </MudChip>
                    }
                    else
                    {
                        <MudText Typo="Typo.body1">N/A</MudText>
                    }
                </MudItem>

                <MudItem xs="12">
                    <MudDivider Class="my-2" />
                    <MudText Typo="Typo.subtitle1" Class="mb-2"><strong>Sync Information</strong></MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Last Synced</MudText>
                    <MudText Typo="Typo.body1">@(Account.LastSyncedDateTime?.ToString("MM/dd/yyyy HH:mm") ?? "N/A")</MudText>
                </MudItem>
                <MudItem xs="6">
                    <MudText Typo="Typo.body2" Color="Color.Secondary">Created</MudText>
                    <MudText Typo="Typo.body1">@Account.CreatedDateTime.ToString("MM/dd/yyyy HH:mm")</MudText>
                </MudItem>
            </MudGrid>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] 
    private IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter]
    public AdrAccount? Account { get; set; }

    private void Cancel() => MudDialog.Cancel();

    private Color GetNextRunStatusColor(string status) => status switch
    {
        "Run Now" => Color.Error,
        "Due Soon" => Color.Warning,
        "Upcoming" => Color.Info,
        "Future" => Color.Default,
        _ => Color.Default
    };

    private Color GetHistoricalStatusColor(string status) => status switch
    {
        "Missing" => Color.Error,
        "Overdue" => Color.Warning,
        "Due Now" => Color.Info,
        _ => Color.Default
    };
}
